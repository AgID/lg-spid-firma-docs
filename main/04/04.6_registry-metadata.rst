.. _`§3`:

Metadata nel registro SPID
==========================

Qualora un IdP o un SP offra il servizio in oggetto, il relativo metadata
pubblicato nel registro SPID contiene l’estensione :code:`<SignatureArt20>`
(*namespace* `spid`) come figlio dell’elemento :code:`<Extensions>` (*namespace*
`samlp`), al cui interno è specificata la modalità tecnica tramite la quale
l’ente federato espone tale servizio.

La suddetta modalità è costituita da:

 * L'elemento :code:`<FileTransferService>` (*namespace* `spid`) dotato dei
   seguenti attributi obbligatori:
    
    a. :code:`name` — identificativo della modalità tecnica, univoco per l’ente
       federato, valorizzato un UUID v4 (come da specifica :RFC:`4122`), ovvero
       da una stringa con un minimo di 3 e un massimo di 16 caratteri del
       sottoinsieme di caratteri ASCII 
       ``01234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-``.
    b. :code:`Location` — URL completo (comprensivo del relativo schema) ove
       l’ente rende disponibile il sistema di trasferimento sicuro dei documenti
       di cui al §\ :ref:`5.2 <§5.2>`.

Si veda a tale scopo il seguente esempio:

.. code-block:: xml

 <md:EntityDescriptor>
     <ds:Signature>...</ds:Signature>
     ...
     <samlp:Extensions
           xmlns:spid="https://spid.gov.it/saml-extensions">
         <spid:SignatureArt20>
             <spid:FileTransferService>
                   id="UUID"
                   Location="https://indirizzo:porta/servizio/DataIO/" />
         </spid:SignatureArt20>
     </samlp:Extensions>
     <md:Organization>...</md:Organization>
     ...
 </md:EntityDescriptor>


Qualora l’elemento :code:`<SignatureArt20>` non sia presente nel metadata,
è da intendersi che l’ente federato *non* offre tale servizio.

Il metadata dei SP che offrono il servizio in oggetto prevede, inoltre un 
*Attribute Consuming Service* specifico:

 * il cui attributo ``index`` è valorizzato con il valore “``77``”;
 
 * privo di alcun attributo nel servizio (nessun elemento :code:`<RequestedAttribute>`);
 
 * contenente almeno un elemento figlio :code:`<ServiceName>` (namespace `md`),
   valorizzato con il nome del servizio in lingua italiana: 
   “Sottoscrizione elettronica ex art.20 CAD”;

Il metadata del SP comprende dunque la seguente struttura:

.. code-block:: xml
   <md:EntityDescriptor […] >
           […]
           <md:SPSSODescriptor […] >
               <md:AttributeConsumingService index="77">
                   <md:ServiceName xml:lang="it">
                       Sottoscrizione elettronica ex art.20 CAD
                   </md:ServiceName>
               </md:AttributeConsumingService>
           […]
       </md:SPSSODescriptor>
   </samlp:Response>


Tutte le evidenze informatiche SAML che si riferiscono al servizio in
oggetto (descritte sia qui che al §\ :ref:`5.1 <§5.1>`) indicano il
riferimento URN al *namespace* XML dell’Agenzia riservato a SPID — nel
proprio elemento radice, ovvero in tutti i singoli elementi interessati
(qui genericamente indicati come :code:`<Element>` di *namespace*
``ns``), come riportato nell’esempio sotto:

.. code-block:: xml
  
 <ns:Element xmlns:spid="https://spid.gov.it/saml-extensions">
     ...
 </ns:Element>


.. forum_italia::
   :topic_id: 6
   :scope: document
