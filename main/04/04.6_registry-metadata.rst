.. _`§4.6`:

Metadata nel registro SPID
==========================

Qualora un IDP, un SP ovvero un soggetto aggregatore offra il servizio
in oggetto, il relativo metadata pubblicato nel registro SPID contiene,
all’interno dell’elemento :code:`<Extensions>` (*namespace* ``samlp``),
le modalità tecniche tramite le quali l’ente federato espone tale
servizio.

Nel metadata dell’IDP è presente una sola estensione :code:`<SignatureArt20>`
(*namespace* ``spid``), *facoltativamente* dotata dell’attributo
:code:`index` valorizzato con “``0``”. Per gli SP e i soggetti
aggregatori sono presenti tante estensioni :code:`<SignatureArt20>`
quanti sono gli *Assertion Consumer Service* dichiarati nel metadata
e al cui indice sono associati biunivocamente mediante valorizzazione
dell’attributo *obbligatorio* :code:`index`. Ciascun elemento
:code:`<SignatureArt20>` contiene dunque:

 * l’elemento :code:`<FileTransferService>` (*namespace* ``spid``),
   contenente il seguente attributo:
   
    * :code:`Location` (*obbligatorio*) —  valorizzato con l’URL
      completo (comprensivo di schema) ove l’ente rende disponibile
      il sistema di trasferimento sicuro dei documenti di cui al
      §\ :ref:`5.2 <§5.2>`;

 * l’elemento :code:`<ShortName>` (*namespace* ``spid``), valorizzato
   con l’abbreviativo unico dell’ente (in particolare del SP *aggregato*,
   nel caso sia tratti del metadata di un soggetto aggregatore), ``usID``,
   introdotto ai §\ :ref:`4.2 <§4.2>` e già utilizzato al §\ :ref:`4.5 <§4.5>`:

Si veda a tale scopo il seguente esempio (l’attributo :code:`index`
è facoltativo per gli IdP, mentre si riferisce all’\ *n*\ -mo 
*Assertion Consumer Service* per gli SP e i soggetti aggregatori:

.. code-block:: xml

 <md:EntityDescriptor>
     <ds:Signature>...</ds:Signature>
     ...
     <samlp:Extensions
           xmlns:spid="https://spid.gov.it/saml-extensions">
         <spid:SignatureArt20 index="n">
             <spid:FileTransferService
                   Location="https://indirizzo/al/DataIO/" />
             <spid:ShortName>usID</spid:ShortName>
         </spid:SignatureArt20>
     </samlp:Extensions>
     <md:Organization>...</md:Organization>
     ...
 </md:EntityDescriptor>

Mediante la struttura appena descritta, tra le altre cose, il metadata
di un soggetto aggregatore può dichiarare i sistemi di trasferimento
sicuro di tutti gli enti che, fra i suoi aggregati, rendono disponibile
il servizio di firma con SPID: sia i SP che gestiscono il sistema
autonomamente, sia quelli che si appoggiano al medesimo sistema di
trasferimento file fornitogli dall’ente aggregatore.

Qualora l’elemento :code:`<SignatureArt20>` non sia presente nel metadata,
è da intendersi che l’ente federato *non* offre tale servizio.

Il metadata dei SP che offrono il servizio in oggetto contiene, all’interno
dell’\ :code:`<EntityDescriptor>` (*namespace* ``md``):

 * Un *Attribute Consuming Service* specifico:

   a. il cui attributo ``index`` è valorizzato con il valore “``77``”;
 
   b. privo di alcun attributo nel servizio (nessun elemento :code:`<RequestedAttribute>`);
 
   c. contenente almeno un elemento figlio :code:`<ServiceName>`
      (*namespace* ``md``), valorizzato con il nome del servizio in lingua
      italiana: “``Sottoscrizione elettronica ex art.20 CAD``”.

Il metadata del SP comprende dunque la seguente struttura:

.. code-block:: xml

 <md:EntityDescriptor>
     ...
     <md:SPSSODescriptor>
         <md:AttributeConsumingService index="77">
             <md:ServiceName xml:lang="it">
                 Sottoscrizione elettronica ex art.20 CAD
             </md:ServiceName>
         </md:AttributeConsumingService>
     ...
     </md:SPSSODescriptor>
 </samlp:Response>


Tutte le evidenze informatiche SAML che si riferiscono al servizio in
oggetto (descritte sia qui che al §\ :ref:`5.1 <§5.1>`) indicano il
riferimento URN https://spid.gov.it/saml-extensions al *namespace* XML
dell’Agenzia riservato a SPID — nel proprio elemento radice, ovvero in
tutti i singoli elementi interessati (qui genericamente indicati come
:code:`<Element>` di *namespace* ``ns``), come riportato nell’esempio
sotto:

.. code-block:: xml
  
 <ns:Element xmlns:spid="https://spid.gov.it/saml-extensions">
     ...
 </ns:Element>


.. forum_italia::
   :topic_id: 12109
   :scope: document
